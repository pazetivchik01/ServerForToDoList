/*!40101 SET NAMES utf8mb4 */;

CREATE TABLE `users` (
  `user_id` int NOT NULL AUTO_INCREMENT,
  `last_name` varchar(50) NOT NULL,
  `first_name` varchar(50) NOT NULL,
  `surname` varchar(50) DEFAULT NULL,
  `login` varchar(50) NOT NULL,
  `password_hash` varchar(255) NOT NULL,
  `role` varchar(20) NOT NULL,
  `created_by` int DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `deleted_at` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`user_id`),
  UNIQUE KEY `login` (`login`),
  KEY `created_by` (`created_by`),
  KEY `idx_users_deleted_at` (`deleted_at`),
  CONSTRAINT `users_ibfk_1` FOREIGN KEY (`created_by`) REFERENCES `users` (`user_id`)
) ENGINE=InnoDB AUTO_INCREMENT=29 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO `users` VALUES (1,'Иванов','Алексей','Петрович','admin','$2a$10$cxpoKELU/O1SSTHboZefiueRYqiqzgYIQQLT7HuNNpHra9XyFQ3/S','admin',NULL,'2022-12-31 15:00:00',NULL),(2,'Петрова','Мария','Сергеевна','manager','$2a$11$nWhCwHtQMaYJwTG3THrUzuDIKH9eDEZgpvLjVPdRDW6Pcu0c0NAHi','manager',1,'2023-01-01 15:00:00',NULL),(3,'Сидоров','Дмитрий','Иванович','worker','$2a$11$wlqIhLVUNTMv2Gt1LY0e9OhSLL4IVhuXFP9B2N/jR04dleBa9LZme','worker',2,'2023-01-02 15:00:00',NULL),(4,'Кузнецова','Елена','Викторовна','worker2','$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi','worker',2,'2023-01-03 15:00:00','2025-06-28 07:12:17'),(5,'Смирнов','Андрей','Александрович','worker31','$2a$11$Sz4BxxnyRaTFw.AoEqmBF.CYPfvIR.OBX6S.GuLGEjRLQ9szSa5nG','manager',2,'2023-01-04 15:00:00','2023-05-31 15:00:00'),(28,'Андреевич','Денис','Романенко','TiV4enko','$2a$11$r5e1kO86sz7/TpgE/e93TO2E3yogyYHEvcJKpad7RvliCQNlkGd5O','admin',1,'2025-06-23 08:08:58',NULL);

DROP TABLE IF EXISTS `task_types`;

CREATE TABLE `task_types` (
  `type_id` int NOT NULL AUTO_INCREMENT,
  `type_name` varchar(50) NOT NULL,
  `is_accessible` tinyint DEFAULT '1',
  PRIMARY KEY (`type_id`),
  UNIQUE KEY `type_name` (`type_name`)
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO `task_types` VALUES (1,'Разработка',1),(2,'Тестирование',1),(3,'Дизайн',1),(4,'Документация',1),(5,'Администрирование',1);

DROP TABLE IF EXISTS `Tasks`;

CREATE TABLE `tasks` (
  `task_id` int NOT NULL AUTO_INCREMENT,
  `title` varchar(100) NOT NULL,
  `description` text,
  `due_date` datetime NOT NULL,
  `due_time` time DEFAULT NULL,
  `start_date` datetime DEFAULT NULL,
  `is_important` tinyint(1) DEFAULT '0',
  `type_id` int DEFAULT NULL,
  `status` tinyint(1) DEFAULT '0',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `created_by` int NOT NULL,
  `completed_at` datetime DEFAULT NULL,
  `is_confirmed` tinyint(1) DEFAULT '0',
  PRIMARY KEY (`task_id`),
  KEY `type_id` (`type_id`),
  KEY `idx_tasks_due_date` (`due_date`),
  KEY `idx_tasks_status` (`status`),
  KEY `idx_tasks_created_by` (`created_by`),
  KEY `idx_tasks_is_confirmed` (`is_confirmed`),
  CONSTRAINT `tasks_ibfk_1` FOREIGN KEY (`type_id`) REFERENCES `task_types` (`type_id`),
  CONSTRAINT `tasks_ibfk_2` FOREIGN KEY (`created_by`) REFERENCES `users` (`user_id`)
) ENGINE=InnoDB AUTO_INCREMENT=75 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO `tasks` VALUES (1,'Обновить сервер','Необходимо обновить ПО на основном сервере','2025-05-01 00:00:00',NULL,'2025-04-20 00:00:00',1,5,0,'2025-04-14 18:00:00',1,NULL,0),(2,'Разработать API','Создать API для интеграции с внешней системой','2025-05-10 00:00:00',NULL,'2025-04-25 00:00:00',1,1,0,'2025-04-19 18:00:00',1,NULL,0),(3,'Протестировать модуль','Провести тестирование модуля оплаты','2025-05-15 00:00:00',NULL,'2025-05-01 00:00:00',0,2,0,'2025-04-24 18:00:00',2,NULL,0),(4,'Исправить баги','Исправить критические баги в релизе','2025-05-20 00:00:00',NULL,'2025-05-05 00:00:00',1,1,0,'2025-04-30 18:00:00',2,NULL,0),(5,'Подготовить отчет','Подготовить ежемесячный отчет по работе отдела','2025-05-25 00:00:00',NULL,'2025-05-10 00:00:00',0,4,0,'2025-05-04 18:00:00',2,NULL,0),(6,'Обновить дизайн','Обновить дизайн главной страницы','2025-05-30 00:00:00',NULL,'2025-05-15 00:00:00',0,3,0,'2025-05-09 18:00:00',2,NULL,0),(7,'Настроить мониторинг','Настроить систему мониторинга серверов','2025-07-03 00:00:00',NULL,'2025-07-01 00:00:00',1,5,0,'2025-05-14 18:00:00',1,NULL,0),(8,'Оптимизировать БД','Провести оптимизацию запросов к базе данных','2025-06-05 00:00:00',NULL,'2025-05-25 00:00:00',1,1,0,'2025-05-19 18:00:00',2,NULL,0),(9,'Провести код-ревью','Провести ревью кода нового функционала','2025-06-07 00:00:00',NULL,'2025-06-01 00:00:00',0,1,0,'2025-05-24 18:00:00',2,NULL,0),(10,'Обновить документацию','Обновить документацию для API','2025-06-08 00:00:00',NULL,'2025-06-05 00:00:00',0,4,0,'2025-05-31 18:00:00',2,NULL,0),(11,'Рефакторинг кода','Провести рефакторинг основного модуля','2025-06-15 00:00:00',NULL,'2025-06-05 00:00:00',1,1,0,'2025-05-31 18:00:00',2,NULL,0),(12,'Тестирование безопасности','Провести тестирование на проникновение','2025-06-16 00:00:00',NULL,'2025-06-06 00:00:00',1,2,0,'2025-06-01 18:00:00',2,NULL,0),(13,'Дизайн иконок','Создать набор иконок для приложения','2025-06-17 00:00:00',NULL,'2025-06-07 00:00:00',0,3,0,'2025-06-02 18:00:00',2,NULL,0),(14,'Написать ТЗ','Составить техническое задание для нового модуля','2025-06-18 00:00:00',NULL,'2025-06-08 00:00:00',0,4,0,'2025-06-03 18:00:00',2,NULL,0),(15,'Обновить сертификаты','Обновить SSL сертификаты','2025-06-19 00:00:00',NULL,'2025-06-09 00:00:00',1,5,0,'2025-06-04 18:00:00',1,NULL,0),(16,'Интеграция с CRM','Интегрировать систему с Salesforce','2025-06-20 00:00:00',NULL,'2025-06-10 00:00:00',1,1,0,'2025-06-05 18:00:00',2,NULL,0),(17,'Оптимизация запросов','Оптимизировать медленные SQL-запросы','2025-06-21 00:00:00',NULL,'2025-06-11 00:00:00',1,1,0,'2025-06-06 18:00:00',2,NULL,0),(18,'Тестирование UI','Провести тестирование пользовательского интерфейса','2025-06-22 00:00:00',NULL,'2025-06-12 00:00:00',0,2,0,'2025-06-07 18:00:00',2,NULL,0),(19,'Разработка дашборда','Создать админ-панель для аналитики','2025-06-23 00:00:00',NULL,'2025-06-13 00:00:00',1,1,0,'2025-06-08 18:00:00',2,NULL,0),(20,'Обновление библиотек','Обновить зависимости проекта','2025-06-24 00:00:00',NULL,'2025-06-14 00:00:00',0,1,0,'2025-06-09 18:00:00',2,NULL,0),(21,'Разработка API завершена','Завершена разработка API для интеграции','2025-05-28 00:00:00',NULL,'2025-05-10 00:00:00',1,1,1,'2025-05-04 18:00:00',2,'2025-07-05 14:54:38',1),(22,'Тестирование модуля оплаты','Тестирование модуля оплаты завершено','2025-06-02 00:00:00',NULL,'2025-05-20 00:00:00',0,2,1,'2025-05-14 18:00:00',2,'2025-07-05 15:04:08',1),(23,'Обновление дизайна','Обновлен дизайн личного кабинета','2025-06-05 00:00:00',NULL,'2025-05-25 00:00:00',0,3,1,'2025-05-19 18:00:00',2,'2025-07-05 15:03:03',1),(24,'Документация API','Документация для нового API готова','2025-06-07 00:00:00',NULL,'2025-05-30 00:00:00',0,4,0,'2025-05-24 18:00:00',2,'2025-06-06 00:00:00',0),(25,'Настройка сервера','Настроен новый production сервер','2025-06-09 00:00:00',NULL,'2025-06-01 00:00:00',1,5,0,'2025-05-27 18:00:00',1,'2025-06-08 00:00:00',1),(26,'Фикс багов авторизации','Исправлены баги в модуле авторизации','2025-05-18 00:00:00',NULL,'2025-05-05 00:00:00',1,1,1,'2025-04-30 18:00:00',2,'2025-05-17 00:00:00',1),(27,'Тестирование безопасности API','Проведено тестирование безопасности API','2025-05-22 00:00:00',NULL,'2025-05-10 00:00:00',1,2,1,'2025-05-04 18:00:00',2,'2025-05-21 00:00:00',1),(28,'Дизайн мобильной версии','Завершен дизайн мобильной версии','2025-05-27 00:00:00',NULL,'2025-05-15 00:00:00',0,3,1,'2025-05-09 18:00:00',2,'2025-05-26 00:00:00',1),(29,'Руководство пользователя','Составлено руководство пользователя','2025-06-01 00:00:00',NULL,'2025-05-20 00:00:00',0,4,1,'2025-05-14 18:00:00',2,'2025-05-31 00:00:00',1),(30,'Резервное копирование','Настроено автоматическое резервное копирование','2025-06-03 00:00:00',NULL,'2025-05-25 00:00:00',1,5,1,'2025-05-19 18:00:00',1,'2025-06-02 00:00:00',1),(31,'Разработать новый модуль','Разработать модуль аналитики','2025-07-01 00:00:00',NULL,'2025-06-20 00:00:00',1,1,0,'2025-06-09 18:00:00',1,NULL,0),(32,'Протестировать новый функционал','Провести тестирование модуля аналитики','2025-07-10 00:00:00',NULL,'2025-07-01 00:00:00',0,2,0,'2025-06-14 18:00:00',2,NULL,0),(33,'Создать лендинг','Разработать лендинг для нового продукта','2025-07-15 00:00:00',NULL,'2025-07-05 00:00:00',0,3,0,'2025-06-19 18:00:00',2,NULL,0),(34,'Обновить политику безопасности','Обновить политику безопасности данных','2025-07-20 00:00:00',NULL,'2025-07-10 00:00:00',1,5,0,'2025-06-24 18:00:00',1,NULL,0),(35,'Подготовить презентацию','Подготовить презентацию для инвесторов','2025-07-25 00:00:00',NULL,'2025-07-15 00:00:00',1,4,0,'2025-06-30 18:00:00',2,NULL,0),(36,'Интегрировать платежную систему','Добавить новую платежную систему','2025-07-30 00:00:00',NULL,'2025-07-20 00:00:00',1,1,0,'2025-07-04 18:00:00',2,NULL,0),(37,'Оптимизировать производительность','Провести оптимизацию производительности приложения','2025-08-01 00:00:00',NULL,'2025-07-25 00:00:00',1,1,0,'2025-07-09 18:00:00',2,NULL,0),(38,'Обновить библиотеки','Обновить зависимости проекта','2025-08-05 00:00:00',NULL,'2025-08-01 00:00:00',0,1,0,'2025-07-14 18:00:00',2,NULL,1),(39,'Провести обучение','Провести обучение новых сотрудников','2025-08-10 00:00:00',NULL,'2025-08-05 00:00:00',0,4,0,'2025-07-19 18:00:00',2,NULL,0),(40,'Разработать мобильное приложение','Начать разработку мобильного приложения','2025-08-15 00:00:00',NULL,'2025-08-10 00:00:00',1,1,0,'2025-07-24 18:00:00',1,NULL,1),(41,'qwe','qwe','2025-06-11 00:00:00',NULL,NULL,0,3,0,'2025-06-11 08:13:37',2,NULL,0),(42,'привет','пока','2025-06-12 00:00:00',NULL,'2025-06-12 00:00:00',0,1,0,'2025-06-11 08:44:52',2,NULL,0),(43,'go','go','2025-06-13 00:00:00',NULL,'2025-06-12 00:00:00',0,2,0,'2025-06-11 08:53:42',2,NULL,0),(44,'123','123','2025-06-13 00:00:00',NULL,'2025-06-12 00:00:00',0,3,0,'2025-06-11 09:09:32',2,NULL,0),(48,'йцу','йцу','2025-06-12 00:00:00',NULL,'2025-06-12 00:00:00',0,3,0,'2025-06-11 12:34:53',2,NULL,0),(49,'Проверка','Описание проверки','2025-09-03 00:00:00','12:00:00','2025-09-02 00:00:00',1,2,0,'2025-07-02 10:26:21',1,'2025-07-02 13:26:21',0),(50,'Очистка','Описание','2025-09-03 00:00:00','06:00:00','2025-09-02 00:00:00',1,3,0,'2025-07-02 10:44:20',1,'2025-07-02 13:44:20',0),(71,'Тестовое задание','Описание для тестового задания','2025-09-05 00:00:00',NULL,NULL,1,2,0,'2025-07-03 11:09:07',1,NULL,0),(72,'Проверка уведомлений','Без описания','2025-09-03 00:00:00',NULL,NULL,0,2,0,'2025-09-02 04:13:07',1,NULL,0),(74,'123','321','2025-09-03 00:00:00',NULL,NULL,0,2,0,'2025-09-02 04:20:15',1,NULL,0);

DROP TABLE IF EXISTS `task_assignments`;

CREATE TABLE `task_assignments` (
  `assignment_id` int NOT NULL AUTO_INCREMENT,
  `task_id` int NOT NULL,
  `user_id` int NOT NULL,
  `assigned_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `assigned_by` int DEFAULT NULL,
  PRIMARY KEY (`assignment_id`),
  UNIQUE KEY `task_id` (`task_id`,`user_id`),
  KEY `assigned_by` (`assigned_by`),
  KEY `idx_task_assignments_user_id` (`user_id`),
  CONSTRAINT `task_assignments_ibfk_1` FOREIGN KEY (`task_id`) REFERENCES `tasks` (`task_id`) ON DELETE CASCADE,
  CONSTRAINT `task_assignments_ibfk_2` FOREIGN KEY (`user_id`) REFERENCES `users` (`user_id`),
  CONSTRAINT `task_assignments_ibfk_3` FOREIGN KEY (`assigned_by`) REFERENCES `users` (`user_id`)
) ENGINE=InnoDB AUTO_INCREMENT=65 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO `task_assignments` VALUES (1,1,2,'2025-04-14 18:00:00',1),(2,2,2,'2025-04-19 18:00:00',1),(3,7,2,'2025-05-14 18:00:00',1),(4,15,2,'2025-06-04 18:00:00',1),(5,20,2,'2025-06-09 18:00:00',1),(6,25,2,'2025-05-27 18:00:00',1),(7,30,2,'2025-05-19 18:00:00',1),(8,31,2,'2025-06-09 18:00:00',1),(9,34,2,'2025-06-24 18:00:00',1),(10,40,2,'2025-07-24 18:00:00',1),(11,3,3,'2025-04-24 18:00:00',2),(12,4,3,'2025-04-30 18:00:00',2),(13,5,4,'2025-05-04 18:00:00',2),(14,6,4,'2025-05-09 18:00:00',2),(15,8,3,'2025-05-19 18:00:00',2),(16,9,4,'2025-05-24 18:00:00',2),(17,10,3,'2025-05-31 18:00:00',2),(18,11,4,'2025-05-31 18:00:00',2),(19,12,3,'2025-06-01 18:00:00',2),(20,13,4,'2025-06-02 18:00:00',2),(21,14,3,'2025-06-03 18:00:00',2),(22,16,4,'2025-06-05 18:00:00',2),(23,17,3,'2025-06-06 18:00:00',2),(24,18,4,'2025-06-07 18:00:00',2),(25,19,3,'2025-06-08 18:00:00',2),(26,21,4,'2025-05-04 18:00:00',2),(27,22,3,'2025-05-14 18:00:00',2),(28,23,4,'2025-05-19 18:00:00',2),(29,24,3,'2025-05-24 18:00:00',2),(30,26,4,'2025-04-30 18:00:00',2),(31,27,3,'2025-05-04 18:00:00',2),(32,28,4,'2025-05-09 18:00:00',2),(33,29,3,'2025-05-14 18:00:00',2),(34,32,4,'2025-06-14 18:00:00',2),(35,33,3,'2025-06-19 18:00:00',2),(36,35,4,'2025-06-30 18:00:00',2),(37,36,3,'2025-07-04 18:00:00',2),(38,37,4,'2025-07-09 18:00:00',2),(39,38,3,'2025-07-14 18:00:00',2),(40,39,4,'2025-07-19 18:00:00',2),(41,7,1,'2025-07-01 13:25:58',1),(42,49,1,'2025-07-02 10:26:05',1),(43,49,3,'2025-07-02 10:26:07',1),(44,50,28,'2025-07-02 10:43:48',1),(45,50,4,'2025-07-02 10:44:19',1),(55,71,1,'2025-07-03 11:09:07',1),(58,74,2,'2025-09-02 04:20:15',1),(59,49,2,'2025-09-02 07:45:51',1),(61,50,2,'2025-09-02 07:47:49',1),(62,72,2,'2025-09-02 07:51:37',1),(64,71,2,'2025-09-02 07:58:59',1);

DROP TABLE IF EXISTS `User_device_tokens`;


CREATE TABLE `user_device_tokens` (
  `token_id` int NOT NULL AUTO_INCREMENT,
  `user_id` int NOT NULL,
  `device_token` varchar(255) NOT NULL,
  `device_type` varchar(50) DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`token_id`),
  UNIQUE KEY `device_token` (`device_token`),
  KEY `user_id` (`user_id`),
  CONSTRAINT `user_device_tokens_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
